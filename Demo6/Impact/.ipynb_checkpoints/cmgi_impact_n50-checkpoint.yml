# Define the system of units to use internally.
InternalUnitSystem:
    UnitMass_in_cgs:        5.9724e27   # Earth mass = 5.9724 × 10^24 kg = 5.9724e27 g
    UnitLength_in_cgs:      6.3710e8    # Earth radius = 6.3710 × 10^6 m = 6.3710e8 cm
    UnitVelocity_in_cgs:    1e5         # 1 km/s = 1e5 cm/s (NOT 1e8!)
    UnitCurrent_in_cgs:     1           # Amperes
    UnitTemp_in_cgs:        1           # Kelvin

# Parameters related to the initial conditions
InitialConditions:
    file_name:  cmgi_impact_n50.hdf5    # Changed to match your output filename
    periodic:   0                       # Non-periodic for isolated collision

# Parameters governing the time integration
TimeIntegration:
    time_begin:     0                   # Start time
    time_end:       3600                # ~1 hour simulation time (3600 seconds)
    dt_min:         1e-7                # VERY small for close approach
    dt_max:         1                   # ~15 minutes maximum timestep
    time_bin_update_frequency: 10       # How often to update timestep bins

# Parameters governing the snapshots
Snapshots:
    subdir:             snapshots       # Sub-directory in which to write the snapshots.
    basename:           cmgi_impact_n50     # Base name for output files
    time_first:         0               # First output time
    delta_time:         10              # Output every ~10 seconds (frequent during impact)
    invoke_stf:         1               # Generate extra statistics files
    invoke_stf_delta_time: 10           # Statistics frequency

# Parameters governing the conserved quantities statistics
Statistics:
    time_first: 0                       # First statistics output
    delta_time: 1                       # Statistics every second

# Parameters controlling restarts
Restarts:
    enable: 1                           # Enable restarts for safety
    delta_time: 3600                    # Save restart every hour
    subdir: restarts                    # Restart directory

# Parameters for the hydrodynamics scheme
SPH:
    resolution_eta:     1.2348          # Standard for 48 neighbors
    CFL_condition:      0.1             # Stricter CFL for stability
    h_max:              2.0             # Larger for stability
    h_tolerance:        1e-4            # Smoothing length tolerance
    max_volume_change:  1.4             # Limit kernel volume changes
    viscosity_alpha:    1.5             # Artificial viscosity
    viscosity_alpha_max: 2.5            # Allow increase for shocks
    viscosity_alpha_min: 0.1            # Minimum viscosity
    viscosity_length:   0.1             # Viscosity decay length
    diffusion_alpha:    0.0             # No thermal diffusion initially
    diffusion_alpha_max: 1.0            # Max thermal diffusion if needed
    diffusion_beta:     0.01            # Thermal diffusion tuning
    # PARTICLE SPLITTING - CRITICAL FOR MASS RESOLUTION
    particle_splitting: 1               # Enable particle splitting
    particle_splitting_mass_threshold: 5e-4  # Mass threshold for splitting
    # MATERIAL PROPERTIES
    H_mass_fraction:   0.0              # Not using primordial H
    H_ionization_temperature: 0         # Not relevant

# Parameters for the self-gravity scheme
Gravity:
    mesh_side_length:   256             # Gravity mesh resolution
    MAC:                adaptive        # Adaptive multipole acceptance
    epsilon_fmm:        0.001           # FMM tolerance
    theta_cr:           0.7             # Opening angle
    eta:                0.025           # Time integration accuracy
    # SOFTENING - MOST CRITICAL PARAMETER
    max_physical_baryon_softening:  0.02  # Softening = 2% of Earth radius
    # For Earth radius = 1 in internal units, this is 0.02
    rebuild_frequency:  0.01            # Tree rebuild frequency
    rebuild_active_fraction: 1.01       # Rebuild trigger
    a_smooth:          1.25             # Long-range force smoothing
    r_cut_max:         4.5              # FMM force cut-off
    r_cut_min:         0.1              # Minimal truncation

# Parameters for the task scheduling
Scheduler:
    max_top_level_cells:    256         # More cells for better load balancing
    task_per_cell:          1.0         # Tasks per cell
    cell_sub_size:          12          # Cell subdivision size

# Parameters related to the equation of state
EoS:
    # Planetary EoS materials
    planetary_use_ANEOS_forsterite:   1     # ANEOS forsterite
    planetary_use_ANEOS_Fe85Si15:     1     # ANEOS Fe85Si15
    # Tabulated EoS file paths - VERIFY THESE PATHS
    planetary_ANEOS_forsterite_table_file:  /path/to/ANEOS_forsterite_S19.txt
    planetary_ANEOS_Fe85Si15_table_file:    /path/to/ANEOS_Fe85Si15_S20.txt

# Domain decomposition
DomainDecomposition:
    initial_grid:          [4, 4, 4]    # Initial domain decomposition
    # For 100k particles, 4^3 = 64 domains is reasonable